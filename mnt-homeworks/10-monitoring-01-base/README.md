# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

1) Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

2) Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

3) Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

4) Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

5) Опишите основные плюсы и минусы pull и push систем мониторинга.

6) Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

    Prometheus
    TICK
    Zabbix
    VictoriaMetrics
    Nagios

## Решение

1) Вне зависимости от того, виртуальная это машина или физический сервер, для его мониторинга я бы использовал следующий набор метрик:
    - CPU Usage: Выше уже было отмечено, что приложение нагружает CPU, следовательно мониторинг использования CPU поможет определить, не перегружается ли система, и предотвратить возможные проблемы с производительностью.
    - Disk Usage: Поскольку текстовые отчеты сохраняются на диск, важно отслеживать использование диска,а именно процессы чтения записи, количество IOPS, задержки на диске, а так же объем свободного пространства, чтобы избежать его переполнения, что может привести к сбоям в работе системы.
    - RAM Usage: Также следует собирать метрики по утилизации оперативной памяти или других проблем, по причине того, что могут возникать утечки памяти или другие проблемы, которые могут замедлить систему или даже привести к ее сбою.
    - HTTP Metrics: Поскольку взаимодействие с платформой осуществляется по протоколу HTTP, следует отслеживать такие метрики, как время отклика, количество запросов в секунду, ошибки сервера (коды состояния 5xx) и ошибки клиента (коды состояния 4xx).
Также я бы добавил отслеживание объема трафика на сетевых интерфейсах, количество открытых файловых дескрипторов и ошибки возникающие внутри приложения. 

2)  Касательно того, что такое RAM/inodes/CPUla:
    - RAM: Это оперативная память компьютера, которая используется для временного хранения данных, обрабатываемых компьютером. Если RAM переполняется, это может замедлить работу системы или даже привести к ее сбою.
    - Inodes: Это структуры данных в файловой системе Unix, которые содержат информацию о файлах. Если вы исчерпаете свои inodes, вы не сможете создавать новые файлы, даже если у вас есть свободное место на диске.
    - CPUla: Это загрузка процессора. Если CPU перегружен, это может замедлить работу системы или даже привести к ее сбою.

    По вопросу о том, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания, можно предложить следующее:
    Для начала необходимо определить целевой уровень качества обслуживания внутри команды, то есть SLO. Далее в него закладывается время на возможный простой сервиса по причине технических работ, таким образом мы получаем SLA, его можно озвучить клиенту. После этого исходя из реальной работы сервиса получаем SLI который должен превышать SLA. Эту информацию передаем менеджеру и он сможет оценить работу сервиса.

3) Для решения поставленной задачи есть несколько относительно безболезненных путей решения:
    - Локальное логирование: Приложение может быть настроено на запись ошибок в локальные файлы журнала. Эти файлы можно затем периодически проверять вручную или с помощью скриптов.
    - Email уведомления: Если количество ошибок не очень велико, можно настроить приложение на отправку уведомлений об ошибках по электронной почте.
    - Использование бесплатных инструментов: Существуют бесплатные инструменты для мониторинга и анализа логов, такие как Logstash, Elasticsearch, Kibana (ELK stack), Graylog и другие. Данные инструменты потребуют определенных знаний для настройки, но взамен дают достаточно мощные инструменты для сбора и анализа логов приложения.
    - Интеграция с системами управления инцидентами: Если у организации уже есть система управления инцидентами, такая как Jira или ServiceNow, можно настроить приложение на автоматическое создание инцидентов при возникновении ошибок.

4) Ошибка состоит в том, что формула не учитывает 3хх коды:
    Итоговый вид формулы
        (summ_2xx_requests + summ_3xx_requests)/summ_all_requests

5)  
   - Плюсы push моделей: упрощенная отправка данных мониторинга в несколько различных систем, более гибкая настройка (можно  тонко определять какие метрики отправлять, а какие нет), менее затратный способ передачи данных и в следствие этого более высокопроизводительный 

   - Плюсы pull моделей: контроль подлинности данных, имеется возможность организации и настройки единого прокси сервера до
   всех агентов, упрощенная отладка во время настройки мониторинга

6)  Prometheus, Nagios - push модель 
    TICK - pull модель 
    Zabbix, VictoriaMetrics - гибридная модель, т.к. могут работать через агентов и самостоятельно опрашивать хосты 

7) Запустил TICK-стэк согласно инструкции в репозитории:
    ![Image alt](https://github.com/gemeral68/devops_netology/blob/main/mnt-homeworks/10-monitoring-01-base/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-07-01%20124259.png)
   
8-9) Последние версии telegraf уже преднастроены на работу с Docker, но к сожалдению нужные метрики так и не появились в панели Measurements and Tags. Прикладываю скрин графика нагрузки на прпоцессор:
    ![Image alt](https://github.com/gemeral68/devops_netology/blob/main/mnt-homeworks/10-monitoring-01-base/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-07-01%20124748.png)


## Доработка
После ряда манипуляций конфиг для запуска контейнера telegraf выглядит следующим образом:
```yml
  telegraf:
    image: telegraf:1.4.0
    user: telegraf:0
    privileged: true
    environment:
      HOSTNAME: "telegraf-getting-started"
    links:
      - influxdb
    volumes:
      - ./telegraf/:/etc/telegraf/:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    depends_on:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"
```
Все метрики появились:

![Image Alt](https://github.com/gemeral68/devops_netology/blob/main/mnt-homeworks/10-monitoring-01-base/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-07-02%20130655.png)
